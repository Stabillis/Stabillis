<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="css/login.css">
  <link rel="stylesheet" href="css/nav&fotter.css">
  <script src="https://kit.fontawesome.com/9e4fa5cb9f.js" crossorigin="anonymous"></script>
  <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css"
    integrity="sha384-wvfXpqpZZVQGK6TAh5PVlGOfQNHSoD2xbE+QkPxCAFlNEevoEH3Sl0sibVcOQVnN" crossorigin="anonymous">

  <title>Login</title>
</head>

<body>
  <div class="nav">
    <input type="checkbox" id="nav-check">
    <div class="nav-header">
      <img style="height: 40px;" src="assets/icon/stabilis_main_side.png" alt="">

    </div>
    <div class="nav-btn">
      <label for="nav-check">
        <span></span>
        <span></span>
        <span></span>
      </label>
    </div>

    <div class="nav-links">
      <a href="./index.html">Home</a>
      <a href="./sobre-nos.html">Sobre nós</a>
      <a href="./loginUsuario.html"> <span id="login">Login</span></a>
    </div>
  </div>
  <div class="banner">
    <div class="container">
      <div class="card">
        <img id="logo" src="assets/icon/stabilis_main_side.png" alt="">

        <p>BEM-VINDO DE VOLTA</p>

        <p>Faça seu login!</p>


        <div class="inputs">
          <input type="email" placeholder="E-mail" id="ipt_email">

        </div>

        <div class="inputs">
          <input type="password" placeholder="Senha" id="ipt_senha">

        </div>


        <div class="botao">
          <button class="btn" onclick="entrar()">Login</button>

          <a href="cadastroEmpresa.html"><button class="btn2">Cadastrar sua empresa</button></a>
        </div>

      </div>
    </div>
  </div>

  <!--footer inicio-->
  <footer class="padding_3x">

    <div class="flex">
      <section class="flex-content padding_1x">
        <a href="#"><i class="fa fa-facebook"></i></a>
        <a href="#"><i class="fa fa-twitter"></i></a>
        <a href="#"><i class="fa fa-linkedin"></i></a>
      </section>
      <section class="flex-content padding_1x">
        <h3>Mapa do site</h3>
        <a href="index.html">Home</a>
        <a href="sobre-nos.html">Sobre nós</a>
        <a href="loginUsuario.html">Login</a>
        <a href="cadastroEmpresa.html">Cadastro</a>
      </section>
      <section class="flex-content padding_1x">
        <h3>Quick Links</h3>
        <a href="#">Jobs</a>
        <a href="#">Brand Assets</a>
        <a href="#">Investor Relations</a>
        <a href="#">Terms of Service</a>
      </section>
      <section class="flex-content padding_1x">
        <h3>Contatos</h3>
        <a href="#">Stabillis@outlook.com.br</a>
        <a
          href="https://www.google.com/maps/dir/-23.4848464,-46.6995227/Rua+Haddock+Lobo,+593+-+Cerqueira+C%C3%A9sar,+S%C3%A3o+Paulo+-+SP,+01414-001/@-23.5213493,-46.7075957,13z/data=!3m1!4b1!4m9!4m8!1m1!4e1!1m5!1m1!1s0x94ce59d2b0377801:0x852c06561ff8743d!2m2!1d-46.6615654!2d-23.5580366">Rua
          Haddock Lobo - 593 - São Paulo SP</a>
        <a href="#">Telefone: (11) 4002-8922</a>
      </section>
      <section class="flex-content image-logo">
        <img src="assets/icon/stabilis_white_above.png" alt="">
      </section>

    </div>
    <div class="flex">


    </div>
  </footer>

  <!--footer fim-->

</body>

</html>

<script>
  function entrar() {
    // aguardar();

    var emailVar = ipt_email.value;
    var senhaVar = ipt_senha.value;

    if (emailVar == "" || senhaVar == "") {
      cardErro.style.display = "block"
      mensagem_erro.innerHTML = "(Mensagem de erro para todos os campos em branco)";
      finalizarAguardar();
      return false;
    }
    else {
      setInterval(sumirMensagem, 5000)
    }

    console.log("FORM LOGIN: ", emailVar);
    console.log("FORM SENHA: ", senhaVar);

    fetch("/usuarios/autenticar", {
      method: "POST",
      headers: {
        "Content-Type": "application/json"
      },
      body: JSON.stringify({
        emailServer: emailVar,
        senhaServer: senhaVar
      })
    }).then(function (resposta) {
      console.log("ESTOU NO THEN DO entrar()!")

      if (resposta.ok) {
        console.log(resposta);

        resposta.json().then(json => {
          console.log(json);
          console.log(JSON.stringify(json));

          sessionStorage.ID_USUARIO = json.idUsuario;
          sessionStorage.EMAIL_USUARIO = json.Email;
          sessionStorage.NOME_USUARIO = json.NomeUsuario;
          sessionStorage.FK_EMPRESA = json.FK_Empresa;
          sessionStorage.PERMISSAO_USUARIO = json.FK_Perfil;

          if (sessionStorage.PERMISSAO_USUARIO == 1) {
            setTimeout(function () {
              window.location = "./dashboard/perfilUsuarioAdmin.html";
            }, 1000); // apenas para exibir o loading
          } else {
            setTimeout(function () {
              window.location = "./dashboard/perfilUsuario.html";
            }, 1000); // apenas para exibir o loading
          }

           
             // apenas para exibir o loading
        });

      } else {

        console.log("Houve um erro ao tentar realizar o login!");

        resposta.text().then(texto => {
          console.error(texto);
          alert("Email e/ou Senha inválidos")
          // finalizarAguardar(texto);
        });
      }

    }).catch(function (erro) {
      console.log(erro);
    })

    return false;
  }

  function sumirMensagem() {
    // cardErro.style.display = "none"
  }


</script>