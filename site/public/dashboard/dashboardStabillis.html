<!DOCTYPE html>
<html lang="pt-br">

<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Dashboard</title>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.4/font/bootstrap-icons.css">
  <link rel="stylesheet" href="../css/dash.css">
  <link rel="stylesheet" href="./dashmaquina.css">
  <script src="../js/funcoes.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

</head>

<body>
  <nav class="side-menu" id="sideMenu">


    <ul>
      <li class="itens-menu">
        <a href="perfilUsuario.html">
          <span class="icon"><i class="bi bi-person"></i></span>
          <span class="txt">Perfil</span>
        </a>
      </li>
      <li class="itens-menu">
        <a href="../suporte.html">
          <span class="icon"><i class="bi bi-columns-gap"></i></span>
          <span class="txt">Suporte</span>
        </a>
      </li>
      <li class="itens-menu">
        <a href="../recuperacaoSenha.html">
          <span class="icon"><i class="bi bi-gear"></i></span>
          <span class="txt">Alterar Senha</span>
        </a>
      </li>
      <li class="itens-menu">
        <a href="../index.html">
          <span class="icon"><i class="bi bi-house"></i></span>
          <span class="txt">Sair</span>
        </a>
      </li>
  </nav>

  <!-------Fim da sidebar------>



  <!--Inicio dos gráficos -->
  <main>

    <!--KPIs-->
    <div class="container">
      <div class="coluna-kpi">
        <div class="card-perigo">
          <p>Perigo</p>
        </div>
        <div class="card-atencao">
          <p>Atenção</p>
        </div>
        <div class="card-estavel">
          <p>Estável</p>
        </div>
      </div>


      <!-- legendas KPI-->

      <div class="legenda-kpi">
        <div class="kpi">
          <div class="circuloverde"></div>
          <span>Tempo de atividade da máquina</span>
          <br><br>
          <p id="tempo-atividade">- dias, --:--:--</p>
        </div>
      </div>
    </div>

    <!--fim legenda -->
    <div class="container-botao">
      <select name="opceos" id="sel_maq" onchange="obterDadosGraficos()">
        <option value="#">Dashboard Geral</option>
      </select>
    </div>

    <div class="boxes-kpi">
      <div class="box-kpi">
        <h4>Máquina com maior uso de CPU nas últimas 24 horas</h3>
          <p id="maquina-maior-cpu"></p>
      </div>
      <div class="box-kpi">
        <h4>Máquina com maior uso de RAM nas últimas 24 horas</h4>
        <p id="maquina-maior-ram"></p>
      </div>
      <div class="box-kpi">
        <h4>Máquina com maior uso de disco nas últimas 24 horas</h4>
        <p id="maquina-maior-disco"></p>
      </div>
      <div class="box-kpi">
        <h4>Máquina mais sobrecarregada nas últimas 24 horas</h4>
        <p id="maquina-mais-sobrecarregada"></p>
      </div>
    </div>

    <div class="container1" id="container1">

    </div>
    </div>
    <!--Colunas da dash por máquina-->
    <div class="dashboard">

      <div class="graficos-disco">

        <div class="status">
          <p>Uso de memória RAM</p>
          <div>
            <canvas id="grafico4" style="width: 50%;"></canvas>
          </div>
        </div>

        <div class="status">
          <p>Total disponível do Disco</p>
          <div>
            <canvas id="grafico5" style="width: 50%;"></canvas>
          </div>
        </div>

      </div>

      <div class="graficos-linha">

        <div class="status">
          <p>Bytes enviados(<span id="medBytesEnv"></span>) e recebidos(<span id="medBytesReb"></span>) da máquina</p>
          <div>
            <canvas id="grafico"></canvas>
          </div>
        </div>

        <div class="status">
          <p>Em uso CPU</p>
          <div>
            <canvas id="grafico3"></canvas>
          </div>
        </div>

      </div>
    </div>

    </div>


  </main>


  <script>
    var fkEmpresa = sessionStorage.FK_EMPRESA
    var naoExisteGrafico = false
    var chartData, chartData3, chartData4, chartData5
    var tempo_atividade = document.getElementById('tempo-atividade')
    tempo_atividade.innerHTML = 'Nenhuma máquina selecionada'

    window.onload = () => {
      atualizarSelectBox(fkEmpresa)
      mostrarDashMaquinas(fkEmpresa)
    };

    function obterDadosGraficos() {
      var dashPorMaquina = document.querySelector('.dashboard')
      var dashGeral = document.querySelector('.container1')
      var boxesKPI = document.querySelector('.boxes-kpi')

      var select = document.getElementById('sel_maq')
      var value = select.options[select.selectedIndex].value

      if (value == '#') {
        dashPorMaquina.style.display = 'none'
        dashGeral.style.display = 'flex'
        boxesKPI.style.display = "flex"

        tempo_atividade = document.getElementById('tempo-atividade')
        tempo_atividade.innerHTML = 'Nenhuma máquina selecionada'
        mostrarDashMaquinas(fkEmpresa)
      } else {
        boxesKPI.style.display = "none"
        dashGeral.style.display = 'none'
        dashPorMaquina.style.display = 'flex'
        obterdadosGrafico(value)
      }
    }

    function mostrarDashMaquinas(fkEmpresa) {
      fetch(`/avisos/listarMaquinas/${fkEmpresa}`).then(function (resposta) {
        if (resposta.ok) {
          if (resposta.status == 204) {
            alert('Não há máquinas cadastradas!')
            throw "Nenhum resultado encontrado!!";
          }

          resposta.json().then(function (resposta) {
            console.log("Dados recebidos: ", JSON.stringify(resposta));

            var feed = document.getElementById('container1');
            // feed.innerHTML = "";
            for (let i = 0; i < resposta.length; i++) {
              var publicacao = resposta[i];

              console.log("MAQUINA: ", publicacao)
              // criando e manipulando elementos do HTML via JavaScript
              var caixaMaquina = document.createElement('div')
              var titulo = document.createElement('h3')

              var caixaCPU = document.createElement('div')
              var tituloCPU = document.createElement('p')
              var dadoCPU = document.createElement('p')

              var caixaRAM = document.createElement('div')
              var tituloRAM = document.createElement('p')
              var dadoRAM = document.createElement('p')

              var caixaDisco = document.createElement('div')
              var tituloDisco = document.createElement('p')
              var dadoDisco = document.createElement('p')

              caixaMaquina.className = 'box1'
              titulo.className = 'title'

              titulo.innerHTML = `Máquina: ${publicacao.nomeMaquina}`
              caixaCPU.className = 'graphic1'
              caixaCPU.id = "cpu-caixa" + publicacao.idMaquina
              tituloCPU.innerHTML = "CPU"
              tituloCPU.className = 'content-box'
              dadoCPU.innerHTML = "teste"
              dadoCPU.className = 'content-box'
              dadoCPU.id = "cpu-maquina" + publicacao.idMaquina

              caixaRAM.className = 'graphic2'
              caixaRAM.id = 'ram-caixa' + publicacao.idMaquina
              tituloRAM.innerHTML = "RAM"
              tituloRAM.className = 'content-box'
              dadoRAM.innerHTML = "teste"
              dadoRAM.className = 'content-box'
              dadoRAM.id = "ram-maquina" + publicacao.idMaquina

              caixaDisco.className = 'graphic3'
              caixaDisco.id = 'disco-caixa' + publicacao.idMaquina
              tituloDisco.innerHTML = "Disco"
              tituloDisco.className = 'content-box'
              dadoDisco.innerHTML = "teste"
              dadoDisco.className = 'content-box'
              dadoDisco.id = "disco-maquina" + publicacao.idMaquina

              caixaMaquina.appendChild(titulo)

              caixaMaquina.appendChild(caixaCPU)
              caixaCPU.appendChild(tituloCPU)
              caixaCPU.appendChild(dadoCPU)

              caixaMaquina.appendChild(caixaRAM)
              caixaRAM.appendChild(tituloRAM)
              caixaRAM.appendChild(dadoRAM)

              caixaMaquina.appendChild(caixaDisco)
              caixaDisco.appendChild(tituloDisco)
              caixaDisco.appendChild(dadoDisco)

              feed.appendChild(caixaMaquina)
            }

            setTimeout(() => atualizarDashGeral(fkEmpresa), 5000)
            // finalizarAguardar();
          });
        } else {
          throw ('Houve um erro na API!');
        }
      }).catch(function (resposta) {
        console.error(resposta);
        // finalizarAguardar();
      });
    }

    function maquinaComMaiorCPU(fkEmpresa) {
      fetch(`/avisos/maiorCPU/${fkEmpresa}`).then(function (resposta) {
        if (resposta.ok) {
          if (resposta.status == 204) {
            alert('Não há máquinas cadastradas!')
            throw "Nenhum resultado encontrado!!";
          }

          resposta.json().then(function (resposta) {
            console.log("Dados recebidos: ", JSON.stringify(resposta));
            var maqMaiorCPU = document.getElementById('maquina-maior-cpu')
            maqMaiorCPU.innerHTML = `${resposta[0].nomeMaquina}: ${resposta[0].usoCPU.toFixed(2)}%`
          });
        } else {
          throw ('Houve um erro na API!');
        }
      }).catch(function (resposta) {
        console.error(resposta);
        // finalizarAguardar();
      });
    }

    function maquinaComMaiorRAM(fkEmpresa) {
      fetch(`/avisos/maiorRAM/${fkEmpresa}`).then(function (resposta) {
        if (resposta.ok) {
          if (resposta.status == 204) {
            alert('Não há máquinas cadastradas!')
            throw "Nenhum resultado encontrado!!";
          }

          resposta.json().then(function (resposta) {
            console.log("Dados recebidos: ", JSON.stringify(resposta));
            var maqMaiorRAM = document.getElementById('maquina-maior-ram')
            maqMaiorRAM.innerHTML = `${resposta[0].nomeMaquina}: ${resposta[0].usoRAM.toFixed(2)}%`
          });
        } else {
          throw ('Houve um erro na API!');
        }
      }).catch(function (resposta) {
        console.error(resposta);
        // finalizarAguardar();
      });
    }

    function maquinaComMaiorDisco(fkEmpresa) {
      fetch(`/avisos/maiorDisco/${fkEmpresa}`).then(function (resposta) {
        if (resposta.ok) {
          if (resposta.status == 204) {
            alert('Não há máquinas cadastradas!')
            throw "Nenhum resultado encontrado!!";
          }

          resposta.json().then(function (resposta) {
            console.log("Dados recebidos: ", JSON.stringify(resposta));
            var porcentDisco = resposta[0].usoDisco * 100 / resposta[0].capacidadeMaxDisco
            var maqMaiorDisco = document.getElementById('maquina-maior-disco')
            maqMaiorDisco.innerHTML = `${resposta[0].nomeMaquina}: ${porcentDisco.toFixed(2)}%`
          });
        } else {
          throw ('Houve um erro na API!');
        }
      }).catch(function (resposta) {
        console.error(resposta);
        // finalizarAguardar();
      });
    }

    function maquinaMaisSobrecarregada(fkEmpresa) {
      fetch(`/avisos/maiorSobrecarga/${fkEmpresa}`).then(function (resposta) {
        if (resposta.ok) {
          if (resposta.status == 204) {
            alert('Não há máquinas cadastradas!')
            throw "Nenhum resultado encontrado!!";
          }

          resposta.json().then(function (resposta) {
            console.log("Dados recebidos: ", JSON.stringify(resposta));
            var maquinaSobrecarregada;

            for (let i = 0; i < resposta.length; i++) {
              var maquinaDaVez = resposta[i];
              var maquinaComparadaSobrecarregada = false;

              for (let j = i + 1; j < resposta.length; j++) {
                var maquinaComparada = resposta[j];

                if (
                  maquinaComparada.disponivelDisco < maquinaDaVez.disponivelDisco &&
                  maquinaComparada.disponivelRAM < maquinaDaVez.disponivelRAM &&
                  maquinaComparada.disponivelCPU < maquinaDaVez.disponivelCPU
                ) {
                  maquinaComparadaSobrecarregada = true;
                  break; // Saia do loop interno se encontrar uma máquina mais sobrecarregada
                }
              }

              if (!maquinaComparadaSobrecarregada) {
                maquinaSobrecarregada = maquinaDaVez.nomeMaquina;
                break; // Saia do loop externo se encontrar a máquina mais sobrecarregada
              }
            }

            var txtMaquinaSobrecarregada = document.getElementById(
              "maquina-mais-sobrecarregada"
            );
            txtMaquinaSobrecarregada.innerHTML = `${maquinaSobrecarregada}`;
          });
        } else {
          throw ('Resposta do banco não veio!');
        }
      }).catch(function (resposta) {
        console.error(resposta);
        // finalizarAguardar();
      });
    }

    function atualizarSelectBox(fkEmpresa) {
      fetch(`/avisos/listarMaquinas/${fkEmpresa}`).then(function (resposta) {
        if (resposta.ok) {
          if (resposta.status == 204) {
            alert('Não há máquinas cadastradas!')
            throw "Nenhum resultado encontrado!!";
          }

          resposta.json().then(function (resposta) {
            console.log("Dados recebidos: ", JSON.stringify(resposta));

            var feed = document.getElementById('sel_maq');
            // feed.innerHTML = "";
            for (let i = 0; i < resposta.length; i++) {
              var publicacao = resposta[i];

              // criando e manipulando elementos do HTML via JavaScript
              var opcao = document.createElement('option')
              opcao.innerHTML = `${publicacao.nomeMaquina}`
              opcao.id = "maquina-" + publicacao.idMaquina
              opcao.value = `${publicacao.idMaquina}`
              feed.appendChild(opcao)
              // console.log("elemento html criado")
              feed.appendChild(opcao);
            }

          });
        } else {
          throw ('Houve um erro na API!');
        }
      }).catch(function (resposta) {
        console.error(resposta);
        // finalizarAguardar();
      });
    }

    function atualizarDashGeral(fkEmpresa) {

      fetch(`/medidas/tempo-real-geral/${fkEmpresa}`, { cache: 'no-store' }).then(function (response) {
        if (response.ok) {
          response.json().then(function (resposta) {

            console.log(`dados recebidos: ${JSON.stringify(resposta)}`);
            console.log(`dados atuais do gráfico:`);
            //console.log(dados);

            for (let i = 0; i < resposta.length; i++) {
              var dadosResposta = resposta[i];

              var cpuMaquina = document.getElementById(`cpu-maquina${dadosResposta.FK_Maquina}`)
              var ramMaquina = document.getElementById(`ram-maquina${dadosResposta.FK_Maquina}`)
              var discoMaquina = document.getElementById(`disco-maquina${dadosResposta.FK_Maquina}`)
              console.log(cpuMaquina)
              var porcentCPU = dadosResposta.usoCPU.toFixed(2)
              var porcentRAM = dadosResposta.usoRAM.toFixed(2)
              var porcentDisco = dadosResposta.usoDisco.toFixed(2)

              cpuMaquina.innerHTML = `${porcentCPU}%`
              ramMaquina.innerHTML = `${porcentRAM}%`
              discoMaquina.innerHTML = `${porcentDisco}%`
            }

            maquinaComMaiorCPU(fkEmpresa)
            maquinaComMaiorRAM(fkEmpresa)
            maquinaComMaiorDisco(fkEmpresa)
            maquinaMaisSobrecarregada(fkEmpresa)
            // Altere aqui o valor em ms se quiser que o gráfico atualize mais rápido ou mais devagar
            var proxAtualizacao = setTimeout(() => atualizarDashGeral(fkEmpresa), 5000);
          });
        } else {
          console.error('Nenhum dado encontrado ou erro na API');
          // Altere aqui o valor em ms se quiser que o gráfico atualize mais rápido ou mais devagar
          var proxAtualizacao = setTimeout(() => atualizarDashGeral(fkEmpresa), 5000);
        }
      })
        .catch(function (error) {
          console.error(`Erro na obtenção dos dados p/ gráfico: ${error.message}`);
        });

    }
    function obterdadosGrafico(idMaquina) {

      fetch(`/medidas/ultimas/${idMaquina}`, { cache: 'no-store' }).then(function (response) {
        if (response.ok) {
          response.json().then(function (resposta) {
            console.log(`dados recebidos: ${JSON.stringify(resposta)}`);
            resposta.reverse();

            plotarGrafico(resposta, idMaquina);

          });
        } else {
          console.error('Nenhum dado encontrado ou erro na API');
        }
      })
        .catch(function (error) {
          console.error(`Erro na obtenção dos dados p/ gráfico: ${error.message}`);
        });
    }

    // Esta função *plotarGrafico* usa os dados capturados na função anterior para criar o gráfico
    // Configura o gráfico (cores, tipo, etc), materializa-o na página e, 
    // A função *plotarGrafico* também invoca a função *atualizarGrafico*
    function plotarGrafico(resposta, idMaquina) {
      console.log('Iniciando plotagem do gráfico...');

      if (naoExisteGrafico) {
        console.log("destruindo graficos")
        naoExisteGrafico = false
        chartData.destroy()
        chartData3.destroy()
        chartData4.destroy()
        chartData5.destroy()
        plotarGrafico(resposta, idMaquina)
      } else {
        naoExisteGrafico = true

        const ctx = document.getElementById('grafico');
        let labels = [];

        chartData = new Chart(ctx, {
          type: 'line',
          data: {
            labels: labels,
            datasets: [{
              label: 'Bytes enviados',
              data: [],
              borderWidth: 1,
              color: '#FFF'
            }, {
              label: 'Bytes recebidos',
              data: [],
              borderWidth: 1
            }]
          },
          options: {
            scales: {
              y: {
                beginAtZero: true
              }
            }
          }
        });
        // termino grafico 1 
        const ctx3 = document.getElementById('grafico3');

        chartData3 = new Chart(ctx3, {
          type: 'line',
          data: {
            labels: labels,
            datasets: [{
              label: 'Uso em %',
              data: [],
              borderWidth: 1
            }]
          },
          options: {
            scales: {
              y: {
                beginAtZero: true
              }
            },
          }
        });

        const ctx4 = document.getElementById('grafico4');

        chartData4 = new Chart(ctx4, {
          type: 'pie',
          data: {
            labels: ['% Em uso', '% Disponível'],
            datasets: [{
              label: [],
              data: [],
              borderWidth: 1,
              backgroundColor: ['#8C4356', '#27628A'],
            }]
          },
          options: {
            scales: {
              y: {
                beginAtZero: true
              }
            }
          }
        });

        const ctx5 = document.getElementById('grafico5');

        chartData5 = new Chart(ctx5, {
          type: 'pie',
          data: {
            labels: ['% Em uso', '% Disponível'],
            datasets: [{
              label: [],
              data: [],
              borderWidth: 1,
              backgroundColor: ['#8C4356', '#27628A']
            }]
          },
          options: {
            scales: {
              y: {
                beginAtZero: true
              }
            }
          }
        });

        for (i = 0; i < resposta.length; i++) {
          var registro = resposta[i];
          // console.log(registro);
          //começando envio de dados do pacote
          var dadoBytesEnviados = registro.bytesEnviados
          var valorBytesEnviados = Number((dadoBytesEnviados.slice(0, 3)).replace(",", "."))
          var medidaBytesEnviados = dadoBytesEnviados.slice(-3)
          medBytesEnv.innerHTML = medidaBytesEnviados

          var dadoBytesRecebidos = registro.bytesRecebidos
          var valorBytesRecebidos = Number((dadoBytesRecebidos.slice(0, 3)).replace(",", "."))
          var medidaBytesRecebidos = dadoBytesRecebidos.slice(-3)
          medBytesReb.innerHTML = medidaBytesRecebidos


          chartData.data.datasets[0].data.push(valorBytesEnviados);
          chartData.data.datasets[1].data.push(valorBytesRecebidos);
          //terminando envio de dados do pacote
          chartData3.data.datasets[0].data.push(registro.usoCPU);

          labels.push(registro.dh)
        }
        chartData4.data.datasets[0].data.push(resposta[0].usoRAM);
        chartData4.data.datasets[0].data.push(resposta[0].disponivelRAM);

        chartData5.data.datasets[0].data.push(resposta[0].usoDisco);
        chartData5.data.datasets[0].data.push(resposta[0].disponivelDisco);

        var tempo_atividade = document.getElementById("tempo-atividade")
        tempo_atividade.innerHTML = `${(resposta[0].tempoAtividade).replace("days", "dias")}`

        chartData.resize()
        chartData3.resize()

        chartData.update();
        chartData3.update();
        chartData4.update();
        chartData5.update();

        setTimeout(() => atualizarGrafico(idMaquina, chartData, chartData3,
          chartData4, chartData5), 5000);
      }

    }

    function atualizarGrafico(idMaquina, chartData, chartData3, chartData4, chartData5) {

      fetch(`/medidas/tempo-real/${idMaquina}`, { cache: 'no-store' }).then(function (response) {
        if (response.ok) {
          response.json().then(function (novoRegistro) {

            console.log(`dados recebidos: ${JSON.stringify(novoRegistro)}`);
            console.log(`dados atuais do gráfico:`);
            //console.log(dados);

            // let avisoCaptura = document.getElementById(`avisoCaptura${idMaquina}`)
            // avisoCaptura.innerHTML = ""


            if (novoRegistro[0].dh == chartData.data.labels[chartData.data.labels.length - 1] && novoRegistro[0].dh == chartData3.data.labels[chartData3.data.labels.length - 1]) {
              console.log("---------------------------------------------------------------")
              console.log("Como não há dados novos para captura, o gráfico não atualizará.")
              //avisoCaptura.innerHTML = "<i class='fa-solid fa-triangle-exclamation'></i> Foi trazido o dado mais atual capturado pelo sensor. <br> Como não há dados novos a exibir, o gráfico não atualizará."
              console.log("Horário do novo dado capturado:")
              console.log(novoRegistro[0].dh)
              console.log("Horário do último dado capturado:")
              console.log(chartData.data.labels[chartData.data.labels.length - 1])
              console.log(chartData3.data.labels[chartData3.data.labels.length - 1])
              console.log("---------------------------------------------------------------")
            } else {
              // tirando e colocando valores no gráfico
              chartData.data.labels.shift();
              chartData3.data.labels.shift(); // apagar o primeiro
              chartData.data.labels.push(novoRegistro[0].dh);
              chartData3.data.labels.push(novoRegistro[0].dh); // incluir um novo momento

              chartData.data.datasets[0].data.shift();  // apagar o primeiro de umidade
              var dadoBytesRecebidos = novoRegistro[0].bytesRecebidos
              var valorBytesRecebidos = Number((dadoBytesRecebidos.slice(0, 3)).replace(",", "."))
              var medidaBytesRecebidos = dadoBytesRecebidos.slice(3)
              chartData.data.datasets[0].data.push(valorBytesRecebidos); // incluir uma nova medida de umidade

              chartData.data.datasets[1].data.shift();  // apagar o primeiro de temperatura
              var dadoBytesEnviados = novoRegistro[0].bytesEnviados
              console.log(dadoBytesEnviados)
              var valorBytesEnviados = Number((dadoBytesEnviados.slice(0, 3)).replace(",", "."))
              var medidaBytesEnviados = dadoBytesEnviados.slice(3)
              chartData.data.datasets[1].data.push(valorBytesEnviados); // incluir uma nova medida de 

              chartData3.data.datasets[0].data.shift();  // apagar o primeiro de temperatura
              chartData3.data.datasets[0].data.push(novoRegistro[0].usoCPU); // incluir uma nova medida de temperatura

              chartData4.data.datasets[0].data.shift();  // apagar o primeiro de temperatura
              chartData4.data.datasets[0].data.push(novoRegistro[0].usoRAM); // incluir uma nova medida de temperatura
              chartData4.data.datasets[0].data.shift()
              chartData4.data.datasets[0].data.push(novoRegistro[0].disponivelRAM)

              chartData5.data.datasets[0].data.shift();  // apagar o primeiro de temperatura
              chartData5.data.datasets[0].data.push(novoRegistro[0].usoDisco); // incluir uma nova medida de temperatura
              chartData5.data.datasets[0].data.shift()
              chartData5.data.datasets[0].data.push(novoRegistro[0].disponivelDisco)

              var tempo_atividade = document.getElementById('tempo-atividade')
              tempo_atividade.innerHTML = `${(novoRegistro[0].tempoAtividade).replace('days', 'dias')}`

              chartData.update();
              chartData3.update();
              chartData4.update();
              chartData5.update();
            }

            // Altere aqui o valor em ms se quiser que o gráfico atualize mais rápido ou mais devagar
            proximaAtualizacao = setTimeout(() => atualizarGrafico(idMaquina, chartData, chartData3,
              chartData4, chartData5), 5000);
          });
        } else {
          console.error('Nenhum dado encontrado ou erro na API');
          // Altere aqui o valor em ms se quiser que o gráfico atualize mais rápido ou mais devagar
          proximaAtualizacao = setTimeout(() => atualizarGrafico(idMaquina, chartData, chartData3,
            chartData4, chartData5), 5000);
        }
      })
        .catch(function (error) {
          console.error(`Erro na obtenção dos dados p/ gráfico: ${error.message}`);
        });

    }

  </script>
</body>

</html>